<!DOCTYPE html>
<html lang="it">
<head>
  
  <!-- [CV] MODFICATO QUESTO META  meta name="viewport" content="width=device-width, initial-scale=1" AGGIUNTI GLI ALTRI 8-12 -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2563eb">

  <title>TimeSheet App</title>

  <style>
    
  /* [CV] MODIFICATO CSS BODY + AGGIUNTO TUTTO IL RESTO 20-52 */

	body {
	  margin: 0;
	  padding: 0;
	  width: 100%;
	  min-height: 100vh;
	  overflow-x: hidden;
	  overflow-y: auto;
	}
	    
    * {
      touch-action: manipulation;
    }
    
    @media (max-width: 480px) {
      .min-h-screen {
        min-height: 100vh;
      }
      
      button {
        min-height: 44px;
      }
      
      input, select {
        min-height: 44px;
        font-size: 16px;
      }
    }
    
    @media (max-width: 768px) {
      body {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }
    }

  </style>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel standalone per sviluppo -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Tailwind in sviluppo -->
  <script src="https://cdn.tailwindcss.com"></script>

        <!-- [LR] MODFICATO QUESTO LINK MANIFET PER FARE PWA -->
        <link rel="manifest" href="manifest.json" />
	<meta name="theme-color" content="#2563eb" />
        <!-- [LR] MODFICATO QUESTO LINK MANIFET PER FARE PWA -->


</head>
<body class="bg-gray-100">
  <div id="root"></div>


<!-- [LR] Per installare PWA -->
      <button id="installBtn" style="display:none; position:fixed; bottom:20px; right:20px; z-index:9999; padding:10px 20px; background:#2563eb; color:#fff; border:none; border-radius:8px; font-size:16px; cursor:pointer;">
        üì≤ Installa App
      </button>
<!-- [LR] Per installare PWA -->




  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;
    const API_PASSWORD = '79857985';


    const ScaleWrapper = ({ children, baseWidth = 430 }) => {
      const wrapperRef = useRef(null);
      const [scale, setScale] = useState(1);
      const updateScale = useCallback(() => {
        const wrapper = wrapperRef.current;
        if (!wrapper) return;
        const available = wrapper.offsetWidth;
        const newScale = available < baseWidth ? baseWidth / available : 1;
        setScale(newScale);
      }, [baseWidth]);
      useEffect(() => {
        updateScale();
        window.addEventListener('resize', updateScale);
        return () => window.removeEventListener('resize', updateScale);
      }, [updateScale]);
      return (
        <div ref={wrapperRef} style={{ width: '100%', overflow: 'hidden' }}>
          <div
            style={{
              transform: `scale(${scale})`,
              transformOrigin: 'top center',
              width: '100%',
            }}
          >
            {children}
          </div>
        </div>
      );
    };

    const TimesheetApp = () => {
      // STATI
      const [currentUser, setCurrentUser] = useState(null);
      const [loginForm, setLoginForm] = useState({ username: '', password: '' });
      const [loginError, setLoginError] = useState('');
      const [currentMonth, setCurrentMonth] = useState(new Date());
      const [timeEntries, setTimeEntries] = useState({});
      const [selectedDate, setSelectedDate] = useState(null);
      const [currentShiftData, setCurrentShiftData] = useState({
        turno1: { entrata: '', uscita: '', pausa: '' },
        turno2: { entrata: '', uscita: '', pausa: '' },
        tipoTurno: ''
      });
      const [showTipoTurno, setShowTipoTurno] = useState(false);
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [showSaveConfirm, setShowSaveConfirm] = useState(false);
      const [isLoading, setIsLoading] = useState(false);

      const tipiTurno = [
        { value: '', label: 'Seleziona turno...' },
        { value: 'P', label: 'P - Pranzo' },
        { value: 'C', label: 'C - Cena' },
        { value: 'P/C', label: 'P/C - Doppio Turno' },
        { value: 'E', label: 'E - Emporio' },
        { value: 'E/P', label: 'E/P - Emporio & Pranzo' }
      ];

      // API via google.script.run per evitare CORS
      const callAPI = (action, data = {}) => {
        setIsLoading(true);
        return new Promise((resolve, reject) => {
          google.script.run
            .withSuccessHandler(result => {
              setIsLoading(false);
              resolve(result);
            })
            .withFailureHandler(err => {
              setIsLoading(false);
              reject(err);
            })
            .apiHandler({ action, params: { apiPassword: API_PASSWORD, ...data } });
        });
      };

      // CALCOLI
      const calculateHours = (entrata, uscita, pausa) => {
        if (!entrata || !uscita) return 0;
        const [eH, eM] = entrata.split(':').map(Number);
        const [uH, uM] = uscita.split(':').map(Number);
        const [pH, pM] = pausa ? pausa.split(':').map(Number) : [0, 0];
        const startMin = eH * 60 + eM;
        let endMin = uH * 60 + uM;
        if (endMin < startMin) endMin += 24 * 60;
        return Math.max(0, (endMin - startMin - (pH * 60 + pM)) / 60);
      };

      const getTotalDayHours = dayData => {
        if (!dayData) return 0;
        return calculateHours(dayData.turno1.entrata, dayData.turno1.uscita, dayData.turno1.pausa)
          + calculateHours(dayData.turno2.entrata, dayData.turno2.uscita, dayData.turno2.pausa);
      };

      const isMonthEditable = monthDate => {
        const today = new Date();
        const cy = today.getFullYear(), cm = today.getMonth(), cd = today.getDate();
        const my = monthDate.getFullYear(), m = monthDate.getMonth();
        if (cd > 1) {
          return my > cy || (my === cy && m >= cm);
        }
        return my > cy ||
          (my === cy && m >= cm) ||
          (my === cy && m === cm - 1);
      };

      // AUTH
      const authenticateUser = async () => {
        const { username, password } = loginForm;
        if (!username || !password) {
          setLoginError('Inserisci username e password');
          return;
        }
        setLoginError('');
        try {
          const result = await callAPI('authenticate', { username, password });
          if (result.success) {
            setCurrentUser(result.user);
            setShowTipoTurno(result.user.tipoTurno === 'Si');
            setIsLoggedIn(true);
            setLoginForm({ username: '', password: '' });
            await loadMonthData(result.user.username);
          } else {
            setLoginError(result.message || 'Errore di autenticazione');
          }
        } catch (e) {
          setLoginError('Errore di connessione: ' + e.message);
        }
      };

      const loadMonthData = async (username = currentUser?.username) => {
        if (!username) return;
        try {
          const result = await callAPI('loadData', {
            username,
            year: currentMonth.getFullYear(),
            month: currentMonth.getMonth()
          });
          if (result.success) setTimeEntries(result.data || {});
          else setTimeEntries({});
        } catch (e) {
          console.error(e);
          setTimeEntries({});
        }
      };

      useEffect(() => {
        if (currentUser) loadMonthData();
      }, [currentMonth]);

      const handleLogin = () => authenticateUser();
      const handleLogout = () => {
        setCurrentUser(null);
        setIsLoggedIn(false);
        setTimeEntries({});
        setSelectedDate(null);
        setShowTipoTurno(false);
        setLoginForm({ username: '', password: '' });
        setLoginError('');
        setCurrentShiftData({
          turno1: { entrata: '', uscita: '', pausa: '' },
          turno2: { entrata: '', uscita: '', pausa: '' },
          tipoTurno: ''
        });
      };

      // CALENDARIO
      const getDaysInMonth = date => {
        const y = date.getFullYear(), m = date.getMonth();
        const first = new Date(y, m, 1), last = new Date(y, m + 1, 0);
        const days = [], startDow = first.getDay();
        for (let i = 0; i < startDow; i++) days.push(null);
        for (let d = 1; d <= last.getDate(); d++) days.push(d);
        return days;
      };
      const formatMonth = date => date.toLocaleDateString('it-IT', { month: 'long', year: 'numeric' });
      const navigateMonth = dir => {
        const nm = new Date(currentMonth);
        nm.setMonth(nm.getMonth() + dir);
        if (dir < 0 && !isMonthEditable(nm)) return;
        setCurrentMonth(nm);
        setSelectedDate(null);
        setCurrentShiftData({
          turno1: { entrata: '', uscita: '', pausa: '' },
          turno2: { entrata: '', uscita: '', pausa: '' },
          tipoTurno: ''
        });
      };
      const selectDate = day => {
        if (!day || !isMonthEditable(currentMonth)) return;
        setSelectedDate(day);
        const key = `${currentMonth.getFullYear()}-${currentMonth.getMonth()}-${day}`;
        setCurrentShiftData(timeEntries[key] || {
          turno1: { entrata: '', uscita: '', pausa: '' },
          turno2: { entrata: '', uscita: '', pausa: '' },
          tipoTurno: ''
        });
      };

      const updateShiftData = (turno, field, value) => {
        if (turno === 'tipoTurno') {
          setCurrentShiftData(prev => ({ ...prev, tipoTurno: value }));
        } else {
          setCurrentShiftData(prev => ({
            ...prev,
            [turno]: { ...prev[turno], [field]: value }
          }));
        }
      };

      const saveHours = async () => {
        if (!selectedDate) return;
        const key = `${currentMonth.getFullYear()}-${currentMonth.getMonth()}-${selectedDate}`;
        const updated = { ...timeEntries, [key]: currentShiftData };
        setTimeEntries(updated);
        try {
          const result = await callAPI('saveData', {
            username: currentUser.username,
            monthData: updated,
            year: currentMonth.getFullYear(),
            month: currentMonth.getMonth()
          });
          if (result.success) {
            setShowSaveConfirm(true);
            setTimeout(() => setShowSaveConfirm(false), 2000);
          } else {
            alert('Errore salvataggio: ' + result.message);
          }
        } catch (e) {
          alert('Errore di connessione: ' + e.message);
        }
      };

      const getTotalHours = () =>
        Object.values(timeEntries)
          .reduce((tot, d) => tot + getTotalDayHours(d), 0)
          .toFixed(1);

      const getDateHours = d => {
        const key = `${currentMonth.getFullYear()}-${currentMonth.getMonth()}-${d}`;
        const dd = timeEntries[key];
        return dd ? getTotalDayHours(dd).toFixed(1) : null;
      };

      const getDateShiftType = d => {
        const key = `${currentMonth.getFullYear()}-${currentMonth.getMonth()}-${d}`;
        return timeEntries[key]?.tipoTurno || null;
      };

      // RENDER
      if (!isLoggedIn) {
        return (
          <div style={{
            minHeight: '100vh',
            backgroundColor: '#f3f4f6',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            padding: '10px'
          }}>
            <div style={{
              backgroundColor: 'white',
              borderRadius: '20px',
              boxShadow: '0 10px 25px rgba(0, 0, 0, 0.1)',
              padding: '30px 20px',
              width: 'calc(100vw - 20px)',
              maxWidth: 'none',
              minHeight: 'calc(100vh - 20px)',
              textAlign: 'center',
              display: 'flex',
              flexDirection: 'column',
              justifyContent: 'center'
            }}>
              {/* Logo e Titolo */}
              <div style={{ marginBottom: '30px', flex: '0 0 auto' }}>

                <div style={{
                  backgroundColor: '#2563eb',
                  width: '100px',
                  height: '100px',
                  borderRadius: '50%',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  margin: '0 auto 20px auto',
                  boxShadow: '0 4px 12px rgba(37, 99, 235, 0.3)'
                }}>
                  <span style={{ color: 'white', fontSize: '50px' }}>üïê</span>
                </div>
                <h1 style={{
                  fontSize: '32px',
                  fontWeight: 'bold',
                  color: '#111827',
                  margin: '0 0 10px 0'
                }}>TimeSheet App</h1>
                <p style={{
                  color: '#6b7280',
                  fontSize: '18px',
                  margin: '0'
                }}>Gestione ore Magazzini scs ETS</p>
              </div>

              {/* Form di Login */}
              <div style={{ marginBottom: '30px', flex: '1 1 auto', display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
                <div style={{ marginBottom: '25px', textAlign: 'left' }}>
                  <label style={{
                    display: 'block',
                    fontSize: '16px',
                    fontWeight: '500',
                    color: '#374151',
                    marginBottom: '10px'
                  }}>Username</label>
                  <input
                    type="text"
                    value={loginForm.username}
                    onChange={e => setLoginForm(prev => ({ ...prev, username: e.target.value }))}
                    style={{
                      width: '100%',
                      padding: '26px 30px',
                      border: '2px solid #d1d5db',
                      borderRadius: '12px',
                      fontSize: '28px',
                      outline: 'none',
                      transition: 'border-color 0.2s',
                      boxSizing: 'border-box'
                    }}
                    placeholder="Inserisci il tuo username"
                    onKeyPress={e => e.key === 'Enter' && handleLogin()}
                    disabled={isLoading}
                    onFocus={e => e.target.style.borderColor = '#2563eb'}
                    onBlur={e => e.target.style.borderColor = '#d1d5db'}
                  />
                </div>

                <div style={{ marginBottom: '25px', textAlign: 'left' }}>
                  <label style={{
                    display: 'block',
                    fontSize: '16px',
                    fontWeight: '500',
                    color: '#374151',
                    marginBottom: '10px'
                  }}>Password</label>
                  <input
                    type="password"
                    value={loginForm.password}
                    onChange={e => setLoginForm(prev => ({ ...prev, password: e.target.value }))}
                    style={{
                      width: '100%',
                      padding: '26px 30px',
                      border: '2px solid #d1d5db',
                      borderRadius: '12px',
                      fontSize: '28px',
                      outline: 'none',
                      transition: 'border-color 0.2s',
                      boxSizing: 'border-box'
                    }}
                    placeholder="Inserisci la tua password"
                    onKeyPress={e => e.key === 'Enter' && handleLogin()}
                    disabled={isLoading}
                    onFocus={e => e.target.style.borderColor = '#2563eb'}
                    onBlur={e => e.target.style.borderColor = '#d1d5db'}
                  />
                </div>

                {loginError && (
                  <div style={{
                    backgroundColor: '#fef2f2',
                    border: '1px solid #fecaca',
                    borderRadius: '8px',
                    padding: '15px',
                    marginBottom: '25px'
                  }}>
                    <p style={{ color: '#dc2626', fontSize: '16px', margin: '0' }}>{loginError}</p>
                  </div>
                )}

                <button
                  onClick={handleLogin}
                  disabled={isLoading}
                  style={{
                    width: '100%',
                    backgroundColor: isLoading ? '#9ca3af' : '#2563eb',
                    color: 'white',
                    fontWeight: '600',
                    padding: '30px',
                    borderRadius: '12px',
                    border: 'none',
                    fontSize: '30px',
                    cursor: isLoading ? 'not-allowed' : 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '10px',
                    transition: 'background-color 0.2s'
                  }}
                  onMouseEnter={e => !isLoading && (e.target.style.backgroundColor = '#1d4ed8')}
                  onMouseLeave={e => !isLoading && (e.target.style.backgroundColor = '#2563eb')}
                >
                  <span style={{ fontSize: '24px' }}>üîë</span>
                  {isLoading ? 'Accesso...' : 'Accedi'}
                </button>
              </div>

              {/* Info Box */}
              <div style={{
                backgroundColor: '#f9fafb',
                borderRadius: '12px',
                padding: '20px',
                textAlign: 'left',
                flex: '0 0 auto'
              }}>
                <p style={{
                  fontSize: '16px',
                  color: '#374151',
                  fontWeight: '500',
                  margin: '0 0 10px 0'
                }}>Attendere che vengano caricate le ore gi√† in memoria:</p>
                <div style={{
                  fontSize: '16px',
                  color: '#6b7280',
                  margin: '0'
                }}>
                  ‚Ä¢ Se non segni le ore nun te pagamo
                </div>
              </div>
            </div>
          </div>
        );
      }

      // APP PRINCIPALE
      const days = getDaysInMonth(currentMonth);
      const weekDays = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];

      return (
        <div className="min-h-screen bg-gray-50">
          {/* Header */}
          <div className="bg-white shadow-sm border-b">
            <div className="w-full max-w-full sm:max-w-md mx-auto px-4 py-4 flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center text-white">üïê</div>
                <div>
                  <h1 className="font-semibold text-gray-900 text-xl">TimeSheet</h1>
                  <p className="text-base text-gray-600">{currentUser.nome}</p>
                </div>
              </div>
              <button onClick={handleLogout} className="p-2 text-gray-600 hover:text-gray-900 rounded-lg hover:bg-gray-100">üö™</button>
            </div>
          </div>

          <div className="w-full max-w-full sm:max-w-md mx-auto p-4">
            {/* Navigazione mese */}
            <div className="bg-white rounded-xl shadow-sm p-4 mb-4">
              <div className="flex items-center justify-between mb-4">
                <button
                  onClick={() => navigateMonth(-1)}
                  disabled={!isMonthEditable(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1))}
                  className={`p-2 rounded-lg transition-colors ${isMonthEditable(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1)) ? 'hover:bg-gray-100 text-gray-700' : 'text-gray-300 cursor-not-allowed'}`}
                >‚Üê</button>
                <div className="text-center">
                  <h2 className="text-xl font-semibold text-gray-900 capitalize">{formatMonth(currentMonth)}</h2>
                  {!isMonthEditable(currentMonth) && <p className="text-sm text-red-600 font-medium">Mese non modificabile</p>}
                </div>
                <button onClick={() => navigateMonth(1)} className="p-2 hover:bg-gray-100 rounded-lg text-gray-700">‚Üí</button>
              </div>

              {/* Calendario */}
              <div className="grid grid-cols-7 gap-1 mb-4">
                {weekDays.map(d => <div key={d} className="text-center text-sm font-medium text-gray-500 py-2">{d}</div>)}
                {days.map((d, i) => {
                  const hasH = d && getDateHours(d);
                  const st = d && showTipoTurno && getDateShiftType(d);
                  const sel = d === selectedDate;
                  const can = isMonthEditable(currentMonth);
                  let cls = 'aspect-square rounded-lg text-base font-medium transition-all ';
                  if (!d) cls += 'invisible';
                  else if (!can) cls += 'opacity-50 cursor-not-allowed';
                  if (sel) cls += ' bg-blue-600 text-white shadow-lg';
                  else if (hasH || st) cls += can ? ' bg-green-100 text-green-800 hover:bg-green-200' : ' bg-gray-200 text-gray-600';
                  else cls += can ? ' bg-gray-50 text-gray-900 hover:bg-gray-100' : ' bg-gray-100 text-gray-400';
                  return (
                    <button key={i} onClick={() => selectDate(d)} disabled={!d || !can} className={cls}>
                      {d && (
                        <div className="flex flex-col items-center justify-center h-full">
                          <span>{d}</span>
                          <div className="text-sm opacity-75 space-y-0.5">
                            {st && <div className="font-semibold">{st}</div>}
                            {hasH && <div>{hasH}h</div>}
                          </div>
                        </div>
                      )}
                    </button>
                  );
                })}
              </div>

              {/* Totale ore mese */}
              <div className="bg-blue-50 rounded-lg p-3 flex items-center justify-between">
                <span className="text-base font-medium text-blue-800">Totale ore mese:</span>
                <span className="text-xl font-bold text-blue-900">{getTotalHours()}h</span>
              </div>
            </div>

            {/* Input orari selezione giorno */}
            {selectedDate && (
              <div className="bg-white rounded-xl shadow-sm p-4 space-y-4">
                <div className="flex items-center justify-between">
                  <h3 className="font-semibold text-gray-900">{selectedDate} {formatMonth(currentMonth).split(' ')[0]}</h3>
                  <div className="text-base font-medium text-blue-600">Totale: {getTotalDayHours(currentShiftData).toFixed(1)}h</div>
                </div>

                {showTipoTurno && (
                  <div>
                    <label className="block text-base font-medium text-gray-700 mb-1">Tipo Turno</label>
                    <select
                      value={currentShiftData.tipoTurno}
                      onChange={e => updateShiftData('tipoTurno', null, e.target.value)}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    >
                      {tipiTurno.map(t => <option key={t.value} value={t.value}>{t.label}</option>)}
                    </select>
                  </div>
                )}

                {['turno1', 'turno2'].map((turno, idx) => (
                  <div key={turno} className="space-y-3">
                    <h4 className="font-medium text-gray-900">{`Turno ${idx + 1}`}</h4>
                    <div className="grid grid-cols-3 gap-3">
                      {['entrata', 'uscita', 'pausa'].map(field => (
                        <div key={field}>
                          <label className="block text-sm font-medium text-gray-700 mb-1">
                            {field.charAt(0).toUpperCase() + field.slice(1)}
                          </label>
                          <input
                            type="time"
                            value={currentShiftData[turno][field]}
                            onChange={e => updateShiftData(turno, field, e.target.value)}
                            className="w-full px-3 py-3 border border-gray-300 rounded text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                          />
                        </div>
                      ))}
                    </div>
                    {(currentShiftData[turno].entrata && currentShiftData[turno].uscita) && (
                      <div className="text-base text-blue-600 font-medium">
                        Ore {`Turno ${idx + 1}`}: {calculateHours(
                          currentShiftData[turno].entrata,
                          currentShiftData[turno].uscita,
                          currentShiftData[turno].pausa
                        ).toFixed(1)}h
                      </div>
                    )}
                  </div>
                ))}

                <button
                  onClick={saveHours}
                  disabled={isLoading}
                  className={`w-full bg-blue-600 hover:bg-blue-700 text-white py-5 px-6 rounded-lg text-lg font-medium transition-colors flex items-center justify-center gap-2 ${isLoading ? 'opacity-50' : ''}`}
                >
                  <span style={{ marginRight: 8 }}>üíæ</span>
                  {isLoading ? 'Salvando...' : 'Salva Dati Giornata'}
                </button>
              </div>
            )}

            {showSaveConfirm && (
              <div className="fixed bottom-4 left-4 right-4 w-full max-w-full sm:max-w-md mx-auto">
                <div className="bg-green-600 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2">
                  <span>‚úÖ</span>
                  <span>Dati salvati con successo!</span>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(
      <ScaleWrapper baseWidth={430}>
        <TimesheetApp />
      </ScaleWrapper>,
      document.getElementById('root')
    );
    
    /* [CV] AGGIUNTI QUESTI JS PER MOBILE 657-689 */

    // Prevenzione zoom su double-tap
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
      const now = (new Date()).getTime();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, false);

    // Prevenzione zoom su pinch
	  
    document.addEventListener('gesturechange', function (e) {
      e.preventDefault();
    });
    document.addEventListener('gestureend', function (e) {
      e.preventDefault();
    });

    // Vibrazione tattile
    function vibrateOnAction() {
      if ('vibrate' in navigator) {
        navigator.vibrate(50);
      }
    }

    document.addEventListener('click', function(e) {
      if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
        vibrateOnAction();
      }
    });

  </script>

        <!-- [LR] MODFICATO QUESTO SCRIPT PER FARE PWA -->
	<script>
 	 if ('serviceWorker' in navigator) {
  	  window.addEventListener('load', () => {
 	     navigator.serviceWorker.register('/TimesheetOz/sw.js')
   	     .then(reg => console.log('‚úÖ Service Worker registered:', reg.scope))
   	     .catch(err => console.log('‚ùå Service Worker error:', err));
 	   });
	  }
	</script>

          <script>
            let deferredPrompt;

            window.addEventListener('beforeinstallprompt', (e) => {
              e.preventDefault();
              deferredPrompt = e;
              document.getElementById('installBtn').style.display = 'block';
            });

            document.getElementById('installBtn').addEventListener('click', async () => {
              if (!deferredPrompt) return;
              deferredPrompt.prompt();
              const choice = await deferredPrompt.userChoice;
              console.log('Install outcome:', choice.outcome);
              deferredPrompt = null;
              document.getElementById('installBtn').style.display = 'none';
            });

            window.addEventListener('appinstalled', () => {
              console.log('App installata con successo');
              document.getElementById('installBtn').style.display = 'none';
            });
          </script>

        <!-- [LR] MODFICATO QUESTO SCRIPT PER FARE PWA -->
</body>

</html>


